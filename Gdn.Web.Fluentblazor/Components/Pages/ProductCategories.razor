@page "/productcategories"
@using System.Text.Json

@inject IHttpClientFactory HttpClientFactory
@inject NavigationManager Navigation

<h3>Categorie prodotto</h3>

@if (productCategories != null)
{
    <FluentButton OnClick="@CreateButtonClick">Nuova categoria prodotto</FluentButton>
    <FluentDataGrid Items="@productCategories.AsQueryable()">
        <PropertyColumn Property="@(p => p.Code)" Sortable="true" />
        <PropertyColumn Property="@(p => p.Name)" Sortable="true" />
        <PropertyColumn Property="@(p => p.Description)" Sortable="true" />
        <PropertyColumn Property="@(p => p.ParentCategoryId)" Sortable="true" />
        <PropertyColumn Property="@(p => p.Level)" Sortable="true" />
    </FluentDataGrid>
}

@code {

    private HttpClient HttpClient => HttpClientFactory.CreateApiClient();
    
    IEnumerable<ProductCategoryViewModel>? productCategories;

    protected override async Task OnInitializedAsync()
    {
        var requestUri = $"productcategory";
        productCategories = await HttpClient.GetFromJsonAsync<IEnumerable<ProductCategoryViewModel>>(requestUri);
    }

    private void CreateButtonClick()
    {
        Navigation.NavigateTo("edit-productcategory");
    }
}
